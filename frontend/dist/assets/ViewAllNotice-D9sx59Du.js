import{r as d,b as h,B as x,j as t,c as L}from"./index-HjvooKpM.js";import{B as A}from"./Badge-D545KJpM.js";import{T as C,O as E,a as $}from"./TablePlaceholder-DrsknVAL.js";import{C as D}from"./Toast-DwbOLzDo.js";import{M as B}from"./Modal-CMuDvb4e.js";import{T as P}from"./Table-C5MtgNzK.js";import"./ThemeProvider-B1N1Idvp.js";import"./hasClass-CVqomwya.js";import"./TransitionWrapper-CBvFqiYv.js";import"./useEventCallback-Dv_9Mjij.js";import"./useTimeout-1ZLlq2F-.js";import"./hook-BUPs70WA.js";import"./Placeholder-Bn63vBcU.js";import"./Col-CN8rXc6_.js";import"./Button-Bo3fKrTY.js";import"./Button-ClrWuGp5.js";function Z(){document.title="CPMS | Notices";const[c,j]=d.useState(!0),[r,i]=d.useState([]),[s,p]=d.useState({}),[u,g]=d.useState(!1),[w,y]=d.useState(""),[_,m]=d.useState(!1),[N,S]=d.useState(""),T=()=>m(!1),v=e=>t.jsx($,{id:"button-tooltip",...e,children:"Delete Notice"});d.useEffect(()=>{(async()=>{try{const l=localStorage.getItem("token"),a=await h.get(`${x}/user/detail`,{headers:{Authorization:`Bearer ${l}`}});p({role:a.data.role})}catch(l){console.log("Error fetching user details => ",l)}})()},[]),d.useEffect(()=>{s!=null&&s.role&&f()},[s==null?void 0:s.role]);const b=async e=>{S(e),m(!0)},M=async e=>{var l;try{const a=await h.post(`${x}/management/delete-notice?noticeId=${e}`);(l=a==null?void 0:a.data)!=null&&l.msg&&(f(),y(a.data.msg),g(!0))}catch(a){console.log("Error while deleting notice => ",a)}m(!1)},f=async()=>{var e,l;try{const a=await h.get(`${x}/management/get-all-notices`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if((s==null?void 0:s.role)==="tpo_admin"){const n=(e=a==null?void 0:a.data)==null?void 0:e.filter(o=>o.sender_role==="tpo_admin"||o.receiver_role==="tpo_admin");i(n)}else if((s==null?void 0:s.role)==="student"){const n=(l=a==null?void 0:a.data)==null?void 0:l.filter(o=>o.receiver_role==="student");i(n)}else i(a.data)}catch(a){console.log("Error while fetching notices => ",a)}finally{j(!1)}};return t.jsxs(t.Fragment,{children:[t.jsx(D,{show:u,onClose:()=>g(!1),message:w,delay:3e3,position:"bottom-end"}),c?t.jsx(C,{}):t.jsx(t.Fragment,{children:t.jsx("div",{className:"",children:t.jsxs(P,{striped:!0,bordered:!0,hover:!0,responsive:"sm",className:"bg-white my-6 rounded-lg shadow w-full text-base max-sm:text-sm",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{style:{width:"2%"},children:"#"}),t.jsx("th",{style:{width:"20%"},children:"Title"}),(s==null?void 0:s.role)!=="student"&&t.jsxs(t.Fragment,{children:[t.jsx("th",{style:{width:"10%"},children:"Sender Role"}),t.jsx("th",{style:{width:"10%"},children:"Receiver Role"})]}),t.jsx("th",{style:{width:"40%"},children:"Message"}),t.jsx("th",{style:{width:"18%"},children:"Time Posted"}),(s==null?void 0:s.role)!=="student"&&t.jsx("th",{style:{width:"5%"},children:"Action"})]})}),t.jsx("tbody",{children:(r==null?void 0:r.length)>0?r==null?void 0:r.map((e,l)=>t.jsxs("tr",{children:[t.jsx("td",{children:l+1}),t.jsx("td",{children:t.jsxs(L,{to:(s==null?void 0:s.role)==="student"?`/student/notice/${e==null?void 0:e._id}`:(s==null?void 0:s.role)==="tpo_admin"?`/tpo/notice/${e==null?void 0:e._id}`:s.role==="management_admin"?`/management/notice/${e==null?void 0:e._id}`:"",className:"no-underline text-blue-500 hover:text-blue-700",children:[e==null?void 0:e.title,(new Date-new Date(e==null?void 0:e.createdAt))/(1e3*60*60*24)<=2&&t.jsx(A,{className:"mx-2",bg:"primary",children:"New"})]})}),(s==null?void 0:s.role)!=="student"&&t.jsxs(t.Fragment,{children:[t.jsxs("td",{children:[(e==null?void 0:e.sender_role)==="management_admin"&&"Management",(e==null?void 0:e.sender_role)==="tpo_admin"&&"TPO"]}),t.jsxs("td",{children:[(e==null?void 0:e.receiver_role)==="tpo_admin"&&"TPO",(e==null?void 0:e.receiver_role)==="student"&&"Student"]})]}),t.jsx("td",{children:e==null?void 0:e.message}),t.jsxs("td",{children:[new Date(e.createdAt).toLocaleDateString("en-IN")+" ",t.jsx("span",{className:"text-gray-500",children:new Date(e.createdAt).toLocaleTimeString("en-IN")})]}),(s==null?void 0:s.role)!=="student"&&((s==null?void 0:s.role)==="tpo_admin"&&(e==null?void 0:e.sender_role)!=="management_admin"||(s==null?void 0:s.role)==="management_admin"?t.jsx(t.Fragment,{children:t.jsx("td",{children:t.jsx("div",{className:"flex justify-around items-center",children:t.jsx(E,{placement:"top",delay:{show:250,hide:400},overlay:v,children:t.jsx("i",{className:"fa-regular fa-trash-can text-2xl cursor-pointer hover:text-red-500",onClick:()=>b(e._id),onMouseEnter:a=>{a.target.classList.remove("fa-regular"),a.target.classList.add("fa-solid")},onMouseLeave:a=>{a.target.classList.remove("fa-solid"),a.target.classList.add("fa-regular")}})})})})}):t.jsx("td",{className:"text-center",children:"-"}))]},e==null?void 0:e._id)):t.jsx("tr",{children:t.jsx("td",{colSpan:"7",children:"No notices found!"})})})]})})}),t.jsx(B,{show:_,close:T,header:"Confirmation",body:"Want to delete notice?",btn:"Delete",confirmAction:()=>M(N)})]})}export{Z as default};
